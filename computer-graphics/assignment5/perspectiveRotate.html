
<table>
<tr>
<td><canvas id=canvas1 width=1000 height=800></td>
<td width=50></td>
<td valign=top>

</tr>


</table>

<script src=drawlib1.js></script>
<script src=martix.js></script>
<script>
   var canvas = initCanvas('canvas1');
   canvas.update = function(g) {
      g.strokeStyle = 'blue';
      g.beginPath();
      // var x = this.cursor.x, y = this.cursor.y;
      var x = 500;
      var y = 400;
      var focalLength = -100;
      var zFrontPosition = 10;
      var zBackPosition = 210;
      var zMoveNegative = - (zBackPosition + zFrontPosition) / 2;
      var zMovePositive = - zMoveNegative;
      var width = 100;
      var factor = (new Date()).getSeconds() % 30;
      var matrix = new Matrix();
      var zNegativeTranslate = matrix.translateZ(zMoveNegative);
      var zPositiveTranslate = matrix.translateZ(zMovePositive);
      var rotateMatrix = matrix.rotateY(factor * 12);
      var rtMatrix = matrix.matrixMultiply(rotateMatrix, zNegativeTranslate);
      var trtMatrix = matrix.matrixMultiply(zPositiveTranslate, rtMatrix);

      var transformPoint = generatePoint(trtMatrix, [width, width, zFrontPosition, 1]);
      var perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.moveTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, 0 - width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, 0 - width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      g.stroke();


      var transformPoint = generatePoint(trtMatrix, [width, width, zFrontPosition, 1]);
      var perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.moveTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, 0 - width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, 0 - width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      g.stroke();

      var transformPoint = generatePoint(trtMatrix, [width, width, zBackPosition, 1]);
      var perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.moveTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, 0 - width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, 0 - width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      g.stroke();

      var transformPoint = generatePoint(trtMatrix, [width, width, zFrontPosition, 1]);
      var perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.moveTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      g.stroke();

      var transformPoint = generatePoint(trtMatrix, [width, 0 - width, zFrontPosition, 1]);
      var perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.moveTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, 0 - width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, 0 - width, zBackPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [0 - width, 0 - width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      transformPoint = generatePoint(trtMatrix, [width, 0 - width, zFrontPosition, 1]);
      perspectiveMatrix = matrix.perspective(focalLength, transformPoint[2]);
      var newPoint = generatePoint(perspectiveMatrix, transformPoint);
      g.lineTo(x+ newPoint[0], y + newPoint[1]);
      g.stroke();



   }

</script>
